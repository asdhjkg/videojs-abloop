!function(t,e){"function"==typeof define&&define.amd?define([],e.bind(this,t,t.videojs)):"undefined"!=typeof module&&module.exports?module.exports=e(t,t.videojs):e(t,t.videojs)}(window,function(q,H){"use strict";function t(n){function a(t){return!isNaN(parseFloat(t))&&isFinite(t)}function t(t){return t&&"[object Function]"==={}.toString.call(t)}function e(t){return!!t}function o(t,e){return e=e||1,H.formatTime(t)+"."+Math.floor(t%1*Math.pow(10,e))}function r(t,e){var n=Math.pow(10,e);return Math.floor(t*n)/n}function i(t){if(void 0!==t){if(a(t))return t;if(/^([+\-])?([\d\.]+)$/i.test(t))return parseFloat(t);var e=/^([+\-])?((([\d]+)(h|:(?=.*:)))?(([\d]+)(m|:|$))?)?(([\d\.]+)s?)?$/i.exec(t);if(!e)return null;var n={match:e[0],sign:e[1],hours:e[4]||0,mins:e[7]||0,secs:e[10]||0},o="-"==n.sign?-1:1,r=60*parseFloat(n.hours)*60+60*parseFloat(n.mins)+parseFloat(n.secs);return a(r)?o*r:null}}function u(){function t(e){return function(t){void 0===n[t]&&(n[t]=e[t].default)}}n=n||{},O.forEach(t(A)),S.forEach(t(B))}function f(){return O.forEach(function(t){E[t]=A[t].validate(E[t])}),D}function c(){return k(n,!0)}function l(t){return t?E.pauseBeforeLooping&&!1===P?(U.pause(),P=!0):(P=!1,U.currentTime(E.start),E.pauseAfterLooping&&U.pause(),B.onLoopCallBack.check(D.onLoopCallBack)&&D.onLoopCallBack(D,U)):(P=!1,U.currentTime(E.start)),D}function s(e){return function(t){return!1===t?E[e]=!1:(void 0!==t&&(t=i(t)),null!==t&&(t=void 0===t?U.currentTime():t,E[e]=t)),D}}function p(e){return function(t){return t=i(t),a(t)&&(E[e]+=t),D}}function d(t){return function(){return E[t]=!E[t],D}}function g(t){(t=t||{}).decimalPlaces=Math.floor(t.decimalPlaces)||3;var e=!1!==E.start?parseFloat(E.start):0,n="#t="+r(e,t.decimalPlaces);if(!1!==E.end){var o=parseFloat(E.end);n+=","+r(o,t.decimalPlaces)}return n}function h(t){if("string"==typeof t&&(t=H.parseUrl(t)),t.hash){var e=/^(#?t=)?([^,]*)(,(.*))?$/,n=t.hash.replace(e,"$2"),o=t.hash.replace(e,"$4");n=i(n),o=i(o),a(n)&&(E.start=parseFloat(n)),a(o)&&(E.end=parseFloat(o))}return D}function L(t){var e,n,o=t;return"string"==typeof t?o=[t]:void 0!==t&&Array.isArray(t)||(o=null!==t&&"object"==typeof t?Object.keys(t):Object.keys(A)),e=E,n={},o.forEach(function(t){void 0!==e[t]&&(n[t]=e[t])}),n}function v(r,a){var e=!a;return a=a||{},O.forEach(function(t){a[t]=!!a[t]||e}),function(){var t=arguments,e=L(),n=r.apply(null,t),o={changed:a,oldOpts:e,newOpts:L()};return D.onOptionsChange&&D.onOptionsChange(o,D,U),N(a),n}}function m(){var t,e,n;if(f(),t=U.currentTime(),(e=C())<(n=x())){if(j=!0,t<n-.5&&e<t&&(t-e<1||E.loopIfAfterEnd||E.loopIfBeforeStart))return!0}else{if(j=!1,t<n-.5&&E.loopIfBeforeStart)return!0;if(e<=t&&(t-e<1||E.loopIfAfterEnd))return!0}return!1}function y(t){!K&&E.enabled&&!U.paused()&&m()&&(K=!0,setTimeout(function(){K=!1},w),l(!0))}function b(t,o){function e(e,n){return function(t){(void 0===n||t.which&&t.which==n)&&(e(o.abLoopPlugin,t),this.updateText())}}var n,r,a=o.controlBar.addChild("Button");return t.leftclick&&a.on("click",e(t.leftclick)),t.rightclick&&(a.el().onmousedown=e(t.rightclick,3).bind(a),a.on("contextmenu",function(t){return t.preventDefault&&t.preventDefault(),t.preventDefault&&t.stopPropagation(),!1})),a.updateText=(n=t.defaultText,r=t.textFunction,function(){var t=r(E)||n;this.el().textContent=t}),a.optionsUsed=t.optionsUsed,a.addClass("abLoopButton"),a.addClass(t.name),a.updateText(),a}n=n||{};var U=this,E={},A={start:{default:0,validate:function(t){return!1===t||a(t)&&0<=t?t:0}},end:{default:!1,validate:function(t){if(!1===t)return t;if(a(t)){var e=U.duration();if(0!==e&&a(e))return 0<=t&&t<=e?t:e<t?e:t;if(0<=t)return t}return!1}},enabled:{default:!1,validate:e},loopIfBeforeStart:{default:!0,validate:e},loopIfAfterEnd:{default:!0,validate:e},pauseBeforeLooping:{default:!1,validate:e},pauseAfterLooping:{default:!1,validate:e}},B={onLoopCallBack:{default:void 0,check:t},onOptionsChange:{default:void 0,check:t}},O=Object.keys(A),S=Object.keys(B),k=function(e,n){return O.forEach(function(t){!n&&void 0===e[t]||(E[t]=e[t])}),f(),D},P=!1,T=function(){return E.enabled=!0,D},F=function(t){t=t||{};var e=U.currentSrc();return e.src&&(e=e.src),e+g(t)},j=!1,x=function(){return!1===E.start?0:E.start},C=function(){return!1===E.end?U.duration():E.end},K=!1,w=a(n.minLoopLength)&&0<n.minLoopLength?n.minLoopLength:200,$={},I=[{name:"start",optionsUsed:["start"],leftclick:function(t,e){e.shiftKey?t.adjustStart(-.5):e.ctrlKey?t.adjustStart(-.05):t.setStart()},rightclick:function(t,e){e.shiftKey?t.adjustStart(.5):e.ctrlKey?t.adjustStart(.05):t.goToStart()},defaultText:"Start",textFunction:function(t){return o(t.start)}},{name:"end",optionsUsed:["end"],leftclick:function(t,e){e.shiftKey?t.adjustEnd(-.5):e.ctrlKey?t.adjustEnd(-.05):t.setEnd()},rightclick:function(t,e){e.shiftKey?t.adjustEnd(.5):e.ctrlKey?t.adjustEnd(.05):t.goToEnd()},defaultText:"End",textFunction:function(t){return o(t.end)}},{name:"enabled",optionsUsed:["enabled","pauseAfterLooping","pauseBeforeLooping"],leftclick:function(t,e){q&&q.prompt?e.ctrlKey?t.applyUrl(R("Set new URL",t.getAbsoluteUrl())):e.altKey?t.applyUrl(R("Set new URL",t.getUrl())):e.shiftKey?t.applyUrlFragment(R("Set new URL fragment",t.getUrlFragment())):t.toggle():t.toggle()},rightclick:function(t,e){var n;q&&q.prompt&&(e.ctrlKey?n=t.getAbsoluteUrl():e.altKey?n=t.getUrl():e.shiftKey&&(n=t.getUrlFragment())),n?M(n):t.cyclePauseOnLooping()},defaultText:"Loop",textFunction:function(t){return t.enabled?t.pauseBeforeLooping&&t.pauseAfterLooping?"PAUSE LOOP PAUSE":t.pauseAfterLooping?"LOOP& PAUSE":t.pauseBeforeLooping?"PAUSE &LOOP":"LOOP ON":"Loop off"}}],M=function(t){q&&q.prompt&&q.prompt("Copy to clipboard: Ctrl+C, Enter",t)},R=function(t,e){return!(!q||!q.prompt)&&q.prompt(t,e)},N=function(n){function t(t,e){return t||n[e]}for(var e in $){var o=$[e];(!o.optionsUsed||o.optionsUsed.reduce(t,!1))&&o.updateText()}},D={validateOptions:v(f),resetToInitialOptions:v(c),setOptions:v(k),getOptions:L,goToStart:l,goToEnd:function(){return P=!1,U.currentTime(E.end),D},setStart:v(s("start"),{start:!0}),setEnd:v(s("end"),{end:!0}),adjustStart:v(p("start"),{start:!0}),adjustEnd:v(p("end"),{end:!0}),enable:v(T,{enabled:!0}),disable:v(function(){return E.enabled=!1,D},{enabled:!0}),toggle:v(d("enabled"),{enabled:!0}),togglePauseAfterLooping:v(d("pauseAfterLooping"),{pauseAfterLooping:!0}),togglePauseBeforeLooping:v(d("pauseBeforeLooping"),{pauseBeforeLooping:!0}),cyclePauseOnLooping:v(function(){var t=E.pauseAfterLooping,e=E.pauseBeforeLooping;return k(t||e?t&&!e?{pauseAfterLooping:!1,pauseBeforeLooping:!0}:!t&&e?{pauseAfterLooping:!0,pauseBeforeLooping:!0}:{pauseAfterLooping:!1,pauseBeforeLooping:!1}:{pauseAfterLooping:!0,pauseBeforeLooping:!1}),D},{pauseBeforeLooping:!0,pauseAfterLooping:!0}),player:U,version:V,getAbsoluteUrl:function(t){return function(t){if(!t.match(/^https?:\/\//)&&q&&q.document){var e=q.document.createElement("div");e.innerHTML='<a href="'+t+'">x</a>',t=e.firstChild.href}return t}(F(t))},getUrl:F,getUrlFragment:g,applyUrl:v(function(t){var e=t.replace(/^(.*?)(#.*)?$/,"$1"),n=t.replace(/^(.*?)(#.*)?$/,"$2"),o=U.currentSrc();return o!=e&&o!=t&&t!=n&&U.src(e),n&&h(n),D},{start:!0,end:!0}),applyUrlFragment:v(h,{start:!0,end:!0}),loopRequired:m,playLoop:v(function(){return f(),l(!1),T(),U.play(),D})};return u(),S.forEach(function(t){B[t].check(n[t])&&(D[t]=n[t])}),v(c)(),U.ready(function(){0!=n.createButtons&&I.forEach(function(t){void 0===$[t.name]&&($[t.name]=b(t,U))}),U.on("ended",function(){j&&E.enabled&&!U.loop()&&U.play()})}),U.abLoopPlugin=D,U.on("timeupdate",y),D.loaded=!0,D}var V="1.0.3";return t.loaded=!1,t.VERSION=V,(H.registerPlugin||H.plugin)("abLoopPlugin",t)});